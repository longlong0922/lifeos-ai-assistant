# LifeOS AI ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - å®Œæˆè¯´æ˜

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒè®¤è¯åŠŸèƒ½

#### åç«¯å®ç°
- âœ… **app/auth.py** - JWT Token å’Œå¯†ç ç®¡ç†
  - å¯†ç å“ˆå¸Œ(bcrypt)
  - Token ç”Ÿæˆå’ŒéªŒè¯
  - æœ‰æ•ˆæœŸ 30 å¤©

- âœ… **api/routes_auth.py** - è®¤è¯ API æ¥å£
  - POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
  - POST /api/auth/login - ç”¨æˆ·ç™»å½•
  - GET /api/auth/me - è·å–ç”¨æˆ·ä¿¡æ¯
  - POST /api/auth/complete-onboarding - å®Œæˆå¼•å¯¼

- âœ… **app/database.py** - æ•°æ®åº“æ‰©å±•
  - æ–°å¢å­—æ®µ: password_hash, email, is_new_user, onboarding_completed
  - æ–°å¢æ–¹æ³•: create_user_with_password(), get_user_by_username()

- âœ… **app/main.py** - é›†æˆè®¤è¯è·¯ç”±
  - å¯¼å…¥ auth_router
  - æ³¨å†Œåˆ° FastAPI åº”ç”¨
  - æ ¹è·¯å¾„é‡å®šå‘åˆ°ç™»å½•é¡µ

#### å‰ç«¯é¡µé¢
- âœ… **web/auth.html** - ç™»å½•/æ³¨å†Œé¡µé¢
  - ç²¾ç¾çš„æ¸å˜è®¾è®¡
  - æ ‡ç­¾åˆ‡æ¢(ç™»å½•/æ³¨å†Œ)
  - è¡¨å•éªŒè¯
  - Token å­˜å‚¨

- âœ… **web/onboarding.html** - æ–°æ‰‹å¼•å¯¼é¡µé¢
  - 3 æ­¥å¼•å¯¼æµç¨‹
  - åŠŸèƒ½ä»‹ç»(6 å¤§åŠŸèƒ½å¡ç‰‡)
  - åˆ›å»ºç¬¬ä¸€ä¸ªä¹ æƒ¯
  - è¿›åº¦æ¡æ˜¾ç¤º

- âœ… **web/index.html** - ä¸»ç•Œé¢æ›´æ–°
  - æ£€æŸ¥ç™»å½•çŠ¶æ€
  - æ˜¾ç¤ºç”¨æˆ·å
  - é€€å‡ºç™»å½•æŒ‰é’®
  - API è¯·æ±‚æºå¸¦ Token

### 2. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### è‡ªåŠ¨è·³è½¬é€»è¾‘
```
æœªç™»å½• â†’ /static/auth.html (ç™»å½•é¡µ)
æ–°ç”¨æˆ· â†’ /static/onboarding.html (å¼•å¯¼é¡µ)
è€ç”¨æˆ· â†’ /static/index.html (ä¸»ç•Œé¢)
```

#### æ•°æ®éš”ç¦»
- æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹æ•°æ®
- ä¹ æƒ¯ã€èŠå¤©ã€ç›®æ ‡å®Œå…¨éš”ç¦»
- åŸºäº user_id æŸ¥è¯¢

### 3. å®‰å…¨æªæ–½
- âœ… å¯†ç  bcrypt åŠ å¯†
- âœ… JWT Token ç­¾å
- âœ… Authorization Header ä¼ è¾“
- âœ… Token æœ‰æ•ˆæœŸæ§åˆ¶

### 4. æ–‡æ¡£è¯´æ˜
- âœ… **docs/AUTHENTICATION.md** - å®Œæ•´ä½¿ç”¨æŒ‡å—
- âœ… **docs/AGENT_EXPLAINED.md** - AI å·¥ä½œåŸç†
- âœ… åŒ…å«å®‰å…¨æ³¨æ„äº‹é¡¹
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨åº”ç”¨

```bash
cd d:\code\progranm\lifeos-ai-assistant
python app/main.py
```

### é¦–æ¬¡ä½¿ç”¨

1. è®¿é—® http://localhost:8000
2. ç‚¹å‡»"æ³¨å†Œ"æ ‡ç­¾
3. å¡«å†™ä¿¡æ¯:
   - ç”¨æˆ·å: ä½ çš„åå­—
   - é‚®ç®±: your@email.com
   - å¯†ç : è‡³å°‘6ä½
   - æ—¶åŒº: ä¸­å›½(UTC+8)
4. ç‚¹å‡»"æ³¨å†Œ"
5. è‡ªåŠ¨è¿›å…¥æ–°æ‰‹å¼•å¯¼
6. äº†è§£åŠŸèƒ½,åˆ›å»ºç¬¬ä¸€ä¸ªä¹ æƒ¯
7. è¿›å…¥ä¸»ç•Œé¢å¼€å§‹ä½¿ç”¨!

### ä¸‹æ¬¡ä½¿ç”¨

1. è®¿é—® http://localhost:8000
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"
4. ç›´æ¥è¿›å…¥ä¸»ç•Œé¢

## âš ï¸ ç”Ÿäº§ç¯å¢ƒé…ç½®

ä½¿ç”¨å‰å¿…é¡»ä¿®æ”¹ `app/auth.py`:

```python
# ä¿®æ”¹å‰(å½“å‰ - ä¸å®‰å…¨)
SECRET_KEY = "your-secret-key-change-in-production-use-random-string"

# ä¿®æ”¹å(ç”Ÿäº§ç¯å¢ƒ)
import secrets
SECRET_KEY = secrets.token_urlsafe(32)  # ç”Ÿæˆéšæœºå¯†é’¥
```

## ğŸ“‹ åŠŸèƒ½æ¸…å•

### è®¤è¯ç³»ç»Ÿ
- âœ… ç”¨æˆ·æ³¨å†Œ
- âœ… ç”¨æˆ·ç™»å½•
- âœ… JWT Token éªŒè¯
- âœ… è‡ªåŠ¨ç™»å½•æ£€æŸ¥
- âœ… é€€å‡ºç™»å½•
- âœ… å¯†ç åŠ å¯†å­˜å‚¨

### æ–°æ‰‹å¼•å¯¼
- âœ… åŠŸèƒ½ä»‹ç»(6 å¤§æ¨¡å—)
- âœ… åˆ›å»ºç¬¬ä¸€ä¸ªä¹ æƒ¯
- âœ… è·³è¿‡é€‰é¡¹
- âœ… å®Œæˆæ ‡è®°
- âœ… è¿›åº¦æ¡æ˜¾ç¤º

### ç”¨æˆ·ä½“éªŒ
- âœ… ç²¾ç¾ UI è®¾è®¡
- âœ… å“åº”å¼å¸ƒå±€
- âœ… åŠ¨ç”»æ•ˆæœ
- âœ… é”™è¯¯æç¤º
- âœ… è‡ªåŠ¨è·³è½¬
- âœ… ç”¨æˆ·åæ˜¾ç¤º

### æ•°æ®å®‰å…¨
- âœ… ç”¨æˆ·æ•°æ®éš”ç¦»
- âœ… å¯†ç åŠ å¯†
- âœ… Token éªŒè¯
- âœ… è¯·æ±‚æˆæƒ

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›ç‚¹

### ä»å•ç”¨æˆ·åˆ°å¤šç”¨æˆ·

**ä¹‹å‰**:
```javascript
// æ‰€æœ‰äººå…±ç”¨ user_id=1
const USER_ID = 1;
```

**ç°åœ¨**:
```javascript
// æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ ID,ä» Token è·å–
USER_ID = localStorage.getItem('user_id');
ACCESS_TOKEN = localStorage.getItem('access_token');
```

### ä»æ— è®¤è¯åˆ°æœ‰è®¤è¯

**ä¹‹å‰**:
```javascript
// ç›´æ¥è°ƒç”¨ API,æ— éªŒè¯
fetch('/api/chat', {
    method: 'POST',
    body: JSON.stringify({message: "ä½ å¥½"})
})
```

**ç°åœ¨**:
```javascript
// æºå¸¦ Token,æœåŠ¡å™¨éªŒè¯èº«ä»½
fetch('/api/chat', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${ACCESS_TOKEN}`
    },
    body: JSON.stringify({message: "ä½ å¥½"})
})
```

### ä»ç›´æ¥è¿›å…¥åˆ°å¼•å¯¼æµç¨‹

**ä¹‹å‰**:
```
æ‰“å¼€ç½‘ç«™ â†’ ç›´æ¥çœ‹åˆ°ä¸»ç•Œé¢
```

**ç°åœ¨**:
```
æ‰“å¼€ç½‘ç«™ â†’ ç™»å½•/æ³¨å†Œ â†’ æ–°æ‰‹å¼•å¯¼ â†’ ä¸»ç•Œé¢
           â†“              â†“          â†“
      éªŒè¯èº«ä»½      å­¦ä¹ åŠŸèƒ½    åˆ›å»ºä¹ æƒ¯
```

## ğŸ“Š æ•°æ®åº“å˜åŒ–

### æ–°å¢å­—æ®µ
```sql
ALTER TABLE users ADD COLUMN password_hash TEXT;
ALTER TABLE users ADD COLUMN email TEXT UNIQUE;
ALTER TABLE users ADD COLUMN is_new_user BOOLEAN DEFAULT 1;
ALTER TABLE users ADD COLUMN onboarding_completed BOOLEAN DEFAULT 0;
ALTER TABLE users ADD COLUMN last_login TIMESTAMP;
```

### æ–°å¢æ–¹æ³•
```python
# åˆ›å»ºå¸¦å¯†ç çš„ç”¨æˆ·
db.create_user_with_password(username, password_hash, email, timezone)

# é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢
db.get_user_by_username(username)

# æ›´æ–°æœ€åç™»å½•æ—¶é—´
db.update_last_login(user_id)

# å®Œæˆæ–°æ‰‹å¼•å¯¼
db.mark_onboarding_completed(user_id)

# æ£€æŸ¥æ˜¯å¦æ–°ç”¨æˆ·
db.is_new_user(user_id)
```

## ğŸ” æµ‹è¯•éªŒè¯

### æ‰‹åŠ¨æµ‹è¯•æµç¨‹

1. **æ³¨å†Œæµ‹è¯•**
   - æ‰“å¼€ http://localhost:8000
   - æ³¨å†Œä¸€ä¸ªæ–°è´¦å·
   - ç¡®è®¤è¿›å…¥å¼•å¯¼é¡µé¢

2. **å¼•å¯¼æµ‹è¯•**
   - æŸ¥çœ‹ 6 å¤§åŠŸèƒ½ä»‹ç»
   - åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä¹ æƒ¯
   - ç¡®è®¤è¿›å…¥ä¸»ç•Œé¢

3. **ç™»å½•æµ‹è¯•**
   - é€€å‡ºç™»å½•
   - ä½¿ç”¨åˆšæ‰çš„è´¦å·ç™»å½•
   - ç¡®è®¤ç›´æ¥è¿›å…¥ä¸»ç•Œé¢(è·³è¿‡å¼•å¯¼)

4. **æ•°æ®éš”ç¦»æµ‹è¯•**
   - åˆ›å»ºç¬¬äºŒä¸ªè´¦å·
   - ç¡®è®¤çœ‹ä¸åˆ°ç¬¬ä¸€ä¸ªè´¦å·çš„æ•°æ®

### API æµ‹è¯•

```bash
# 1. æ³¨å†Œ
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@test.com","password":"123456","timezone":"Asia/Shanghai"}'

# 2. ç™»å½•
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'

# 3. è·å–ç”¨æˆ·ä¿¡æ¯(æ›¿æ¢ YOUR_TOKEN)
curl http://localhost:8000/api/auth/me \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ‰ æ€»ç»“

ç°åœ¨ LifeOS AI å·²ç»æ‹¥æœ‰å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿ!

**ä¸»è¦ç‰¹ç‚¹**:
- ğŸ” å®‰å…¨çš„ç”¨æˆ·è®¤è¯
- ğŸ‘¤ ç‹¬ç«‹çš„ç”¨æˆ·æ•°æ®
- ğŸ“ å‹å¥½çš„æ–°æ‰‹å¼•å¯¼
- ğŸ’ ç²¾ç¾çš„ç•Œé¢è®¾è®¡
- ğŸš€ å®Œæ•´çš„ä½¿ç”¨æµç¨‹

**ä¸‹ä¸€æ­¥å¯ä»¥åš**:
- æ·»åŠ å¿˜è®°å¯†ç åŠŸèƒ½
- é‚®ç®±éªŒè¯
- ç¤¾äº¤ç™»å½•(å¾®ä¿¡/QQ)
- ç”¨æˆ·è®¾ç½®é¡µé¢
- å¯¼å‡º/å¯¼å…¥æ•°æ®
- å¤šç«¯åŒæ­¥

ç°åœ¨å¯ä»¥å¯åŠ¨åº”ç”¨,å¼€å§‹ä½¿ç”¨å…¨æ–°çš„ç”¨æˆ·ç³»ç»Ÿäº†! ğŸŠ
